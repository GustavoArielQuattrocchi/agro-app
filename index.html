<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>Orden de Cura ‚Äì Agroqu√≠micos</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="no-print">
    <h1>üßæ Orden de Cura</h1>
    <div class="btns">
      <button class="btn primary" id="btnNueva">Nueva</button>
      <button class="btn light" id="btnGuardar">Guardar</button>
      <button class="btn light" id="btnListado">Buscar</button>
      <button class="btn warning" id="btnPDF">PDF</button>
      <button class="btn light" id="btnBackup">Backup</button>
      <label class="btn light" for="restoreFile">Restaurar</label>
      <input id="restoreFile" type="file" accept=".json,application/json" style="display:none" />
      <button class="btn light" id="btnLogin">Login</button>
      <button class="btn light" id="btnLogout" style="display:none">Salir</button>
      <button class="btn light" id="btnSync" title="Forzar sincronizaci√≥n">Sync</button>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <h2>Datos principales</h2>
        <div class="row">
          <div>
            <label>N¬∞ OC</label>
            <input id="oc" type="text" readonly class="tbl-input" value="" />
            <div class="hint">Auto: <strong id="ocVisible">‚Äî</strong></div>
          </div>
          <div>
            <label>Fecha</label>
            <input id="fecha" type="date" class="tbl-input" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>FINCA</label>
            <select id="finca" class="tbl-input">
              <option value="">Seleccion√°‚Ä¶</option>
              <option>FOA</option><option>FLP</option><option>SC1</option>
              <option>SC2</option><option>SC3</option><option>FSP</option>
            </select>
          </div>
          <div>
            <label>Cultivo</label>
            <select id="cultivo" class="tbl-input">
              <option value="">Seleccion√°‚Ä¶</option>
              <option>VID</option><option>NOGAL</option><option>OTROS</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Manejo</label>
            <select id="manejo" class="tbl-input">
              <option value="">Seleccion√°‚Ä¶</option>
              <option>Org√°nico</option><option>Convencional</option>
            </select>
          </div>
          <div>
            <label>Profesional</label>
            <select id="tecnico" class="tbl-input">
              <option value="">Seleccion√°‚Ä¶</option>
              <option>Quattrocchi</option><option>Mateu</option><option>Gutierrez</option>
            </select>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Aplicaci√≥n</h2>
        <div class="row">
          <div>
            <label>Tractorista</label>
            <input id="tractorista" type="text" class="tbl-input" placeholder="Nombre" />
          </div>
          <div>
            <label>Tractor</label>
            <input id="tractor" type="text" class="tbl-input" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Maquinaria</label>
            <input id="maquinaria" type="text" class="tbl-input" placeholder="Ej: Turbina" />
          </div>
          <div>
            <label>Vol. Tanque (L)</label>
            <input id="volumenMaquinaria" type="number" step="any" min="0.01" class="tbl-input" placeholder="Litros" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Aplicaci√≥n (L/ha)</label>
            <input id="volumenAplicacion" type="number" step="any" min="0.01" class="tbl-input" placeholder="L/ha" />
          </div>
          <div>
            <label>Cuartel/Lote</label>
            <input id="cuartel" type="text" class="tbl-input" placeholder="Ej: C12" />
          </div>
        </div>
      </section>
    </div>

    <section class="card">
      <h2>Productos</h2>
      <div class="tools no-print">
        <span class="factor" id="factorChip">Factor: ‚Äî</span>
        <div class="right">
          <button class="btn small light" id="addItem">+ Item</button>
          <button class="btn small danger" id="clearItems">Vaciar</button>
        </div>
      </div>

      <datalist id="dlProductos"></datalist>

      <div class="table-responsive">
        <table id="items">
          <thead>
            <tr>
              <th style="min-width:140px">Producto</th>
              <th style="min-width:120px">Ing. Activo</th>
              <th style="min-width:80px">Pres.</th>
              <th style="min-width:80px">Dosis/ha</th>
              <th style="min-width:80px">Dosis/Maq</th>
              <th style="min-width:140px">Obs</th>
              <th class="no-print" style="width:50px"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <label style="margin-top:10px">Indicaciones generales</label>
      <textarea id="indicaciones" class="tbl-input" placeholder="Observaciones generales..."></textarea>
    </section>

    <section class="card no-print-block">
      <h2>Vista Previa</h2>
      <div class="paper" id="printArea">
        <h1 id="printTitle">Orden de cura ‚Äì BODEGA SALENTEIN</h1>
        <div class="meta" id="metaBox"></div>
        <table id="printTable">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Ing. Activo</th>
              <th>Pres.</th>
              <th>Dosis/Maq</th>
              <th>Obs.</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div style="margin-top:10px">
          <strong>Indicaciones:</strong>
          <div id="printIndicaciones" style="white-space: pre-wrap; margin-top:4px"></div>
        </div>
      </div>
    </section>
  </main>

  <div class="modal" id="modal">
    <div class="sheet">
      <h3>√ìrdenes guardadas</h3>
      <div class="row">
        <div>
          <input id="q" type="text" class="tbl-input" placeholder="Buscar..." />
        </div>
        <div style="align-self:end; display:flex; gap:8px">
          <button class="btn small light" id="btnRefrescar">‚Üª</button>
          <button class="btn small danger" id="btnCerrarModal">Cerrar</button>
        </div>
      </div>
      <div class="table-responsive">
        <table id="tablaListado" style="margin-top:12px">
          <thead>
            <tr>
              <th>OC</th><th>Fecha</th><th>FINCA</th><th>Cultivo</th>
              <th class="no-print">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="modal" id="loginModal">
    <div class="sheet">
      <h3>Iniciar sesi√≥n</h3>
      <p>Ingres√° tu email para recibir el enlace de acceso.</p>
      <div class="row">
        <div>
          <label>Email</label>
          <input id="loginEmail" type="email" class="tbl-input" placeholder="tucorreo@empresa.com" />
        </div>
        <div style="align-self:end">
          <button class="btn primary" id="btnSendMagicLink">Enviar</button>
          <button class="btn light" id="btnCloseLogin">Cancelar</button>
        </div>
      </div>
    </div>
  </div>

  <div id="cloudStatus" class="no-print" title="Estado de la nube">Offline</div>
  <div id="storageStatus" class="no-print">Iniciando...</div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="script.js"></script>
</body>
</html>